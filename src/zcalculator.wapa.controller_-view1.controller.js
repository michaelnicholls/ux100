sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller"                                                                                                                                                                                                                                  
], function(Controller) {                                                                                                                                                                                                                                      
	"use strict";                                                                                                                                                                                                                                                 
	var source = "CDS";                                                                                                                                                                                                                                           
	var fixed;// = "/sap/opu/odata/SAP/Z_DYNAMIC_TILE_SRV";                                                                                                                                                                                                       
//	fixed = "/sap/opu/odata/SAP/ZCALCULATOR_SRV";                                                                                                                                                                                                               
	                                                                                                                                                                                                                                                              
	return Controller.extend("p1.controller.View1", {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
		onInit: function() {                                                                                                                                                                                                                                         
			var oStartupParameters;                                                                                                                                                                                                                                     
			try {                                                                                                                                                                                                                                                       
			oStartupParameters = this.getOwnerComponent().getComponentData().startupParameters;                                                                                                                                                                         
			} catch(err) {}                                                                                                                                                                                                                                             
			                                                                                                                                                                                                                                                            
			if (oStartupParameters && oStartupParameters.source) {                                                                                                                                                                                                      
				source = oStartupParameters.source[0];                                                                                                                                                                                                                     
			} else {                                                                                                                                                                                                                                                    
				source = jQuery.sap.getUriParameters().get("source");                                                                                                                                                                                                      
				if (source === null) {                                                                                                                                                                                                                                     
					source = "CDS";                                                                                                                                                                                                                                           
				}&nbsp;                                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
			if (source==="CDS") {                                                                                                                                                                                                                                       
				fixed = "/sap/opu/odata/sap/ZCALC_CDS";	                                                                                                                                                                                                                   
			} else {                                                                                                                                                                                                                                                    
				fixed =  "/sap/opu/odata/SAP/ZCALCULATOR_SRV";                                                                                                                                                                                                             
			}                                                                                                                                                                                                                                                           
			var r1 = 1 + Math.floor(Math.random() * 50);                                                                                                                                                                                                                
			var r2 = 1 + Math.floor(Math.random() * 50);                                                                                                                                                                                                                
			var params = "/calculatorSet(operand1="+r1+",operator='%2B',operand2="+r2+")?$format=json";                                                                                                                                                                 
			if (source==="CDS") {                                                                                                                                                                                                                                       
			 params = "/ZCALCSet(operand1="+r1+",operand2="+r2+",operator='%2B',x='')";&nbsp;                                                                                                                                                                           
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			var oModel = new sap.ui.model.odata.v2.ODataModel(fixed);                                                                                                                                                                                                   
			var validops = "+";                                                                                                                                                                                                                                         
			var jsonModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                          
			var opModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                            
			oModel.read(params,{                                                                                                                                                                                                                                        
			success: function(oData,oResponse){                                                                                                                                                                                                                         
				jsonModel.setData(oData);                                                                                                                                                                                                                                  
				validops=oData.ops;                                                                                                                                                                                                                                        
		                                                                                                                                                                                                                                                             
			opModel.setData({ops: [],source: source});                                                                                                                                                                                                                  
			var t=opModel.getData();                                                                                                                                                                                                                                    
			var opsArray = Array.from(validops);                                                                                                                                                                                                                        
			for (var i=0;i<opsArray.length;i++)                                                                                                                                                                                                                         
				{                                                                                                                                                                                                                                                          
					t.ops.push({op:opsArray[i]});                                                                                                                                                                                                                             
				}                                                                                                                                                                                                                                                          
				opModel.setData(t);                                                                                                                                                                                                                                        
			},                                                                                                                                                                                                                                                          
			error: function(oError){                                                                                                                                                                                                                                    
			                                                                                                                                                                                                                                                            
			}                                                                                                                                                                                                                                                           
		});                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			this.getView().setModel(opModel, "ops");                                                                                                                                                                                                                    
  			this.getView().setModel(jsonModel);                                                                                                                                                                                                                       
  		                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
		onCopy: function(oEvent) {                                                                                                                                                                                                                                   
			var res = Math.floor(this.getView().getModel().getProperty('/res')); // CDS version                                                                                                                                                                         
			this.getView().getModel().setProperty('/operand1', res); // CDS version                                                                                                                                                                                     
			this.onGo();                                                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
		onGo: function(oEvent) {                                                                                                                                                                                                                                     
			var op1 = this.getView().byId("op1").getValue();                                                                                                                                                                                                            
			var op2 = this.getView().byId("op2").getValue();                                                                                                                                                                                                            
			var op = this.getView().byId("op").getSelectedButton().getText();                                                                                                                                                                                           
			if (op1 === undefined) {                                                                                                                                                                                                                                    
				op1 = "";                                                                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
			if (op2 === undefined) {                                                                                                                                                                                                                                    
				op2 = "";                                                                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
			if (op1 === "" || op2 === "") {                                                                                                                                                                                                                             
				this.getView().getModel().setProperty("/error", "operand1 and operand2 required");                                                                                                                                                                         
			this.getView().getModel().setProperty("/res",0);&nbsp;                                                                                                                                                                                                      
			} else if (op1.toString().includes(".") || op2.toString().includes(".")) {                                                                                                                                                                                  
				this.getView().getModel().setProperty("/error", "integers only");                                                                                                                                                                                          
					this.getView().getModel().setProperty("/res",0);&nbsp;                                                                                                                                                                                                    
			} else {                                                                                                                                                                                                                                                    
				var v = this.getView();                                                                                                                                                                                                                                    
				var params = "/calculatorSet(operand1=" + op1 + ",operator='" + encodeURIComponent(op) + "',operand2=" + op2 + ")?$format=json";                                                                                                                           
				if (source==="CDS") {                                                                                                                                                                                                                                      
				params ="/ZCALCSet(operand1="+op1+",operand2="+op2+",operator='"+encodeURIComponent(op)+"',x='')";&nbsp;                                                                                                                                                   
				};                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				var oModel = new sap.ui.model.odata.v2.ODataModel(fixed);                                                                                                                                                                                                  
				var jsonModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                         
				oModel.read(params,{                                                                                                                                                                                                                                       
					success: function(oData,oResponse){                                                                                                                                                                                                                       
						jsonModel.setData(oData);                                                                                                                                                                                                                                
						v.setModel(jsonModel);                                                                                                                                                                                                                                   
					},                                                                                                                                                                                                                                                        
					error: function(oError){                                                                                                                                                                                                                                  
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
				);                                                                                                                                                                                                                                                         
				//this.getView().setModel(jsonModel);                                                                                                                                                                                                                      
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            